(()=>{"use strict";var e={91:(e,t,r)=>{r.r(t);var n=r(619),a=r.n(n),s=r(5);a().connect(s.Z.db_url,{useNewUrlParser:!0,useCreateIndex:!0,useUnifiedTopology:!0,useFindAndModify:!1})},5:(e,t,r)=>{r.d(t,{Z:()=>i}),require("path");var n=r(242),a=r.n(n),s="production".trim(),u="".concat(process.cwd(),"\\.env.").concat(s).trim();r(334).config({path:u});const i={port:process.env.API_PORT||9999,db_url:process.env.DB_URL||"mongodb://127.0.0.1:27017/webfolio-api",jwt_secret:process.env.JWT_SECRET||"HJ&ewgwqu$%@ytwIIygtdygweyt^//23e7wqyewg*wquy@AY%tw55U6f5",app_env:"devremote"===s?a().red(process.env.API_ENV):a().yellow(process.env.API_ENV)||"no fucking clue...."}},353:(e,t,r)=>{r.r(t),r.d(t,{default:()=>u});var n=r(619),a=r.n(n),s=(r(234),new(a().Schema)({isForeground:{type:Boolean,required:!1,default:!1},orientation:{type:String,required:!1,default:"portrait"},displayOrder:{type:Number},sliderImgUrl:{type:String,required:!1},sliderImgData:{type:Buffer}}));const u=a().model("SliderImg",s)},242:e=>{e.exports=require("chalk")},334:e=>{e.exports=require("dotenv")},619:e=>{e.exports=require("mongoose")},234:e=>{e.exports=require("validator")}},t={};function r(n){var a=t[n];if(void 0!==a)return a.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,r),s.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{r(91);var e=r(5),t=r(242),n=r.n(t);const a=require("express");var s=r.n(a);const u=require("@babel/runtime/helpers/asyncToGenerator");var i=r.n(u);const c=require("@babel/runtime/regenerator");var o=r.n(c),p=r(619),d=r.n(p),f=r(234),l=r.n(f),v=new(d().Schema)({category:{type:String,required:!0,trim:!0},displayOrder:{type:Number,required:!1,default:-1},active:{type:Boolean,required:!0,default:!0}},{timestamps:!0});const m=d().model("Category",v);var x=function(){var e=i()(o().mark((function e(t,r){var n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new m(t.body),e.prev=1,e.next=4,m.find({}).sort({displayOrder:-1}).limit(1).then((function(e){return e[0].displayOrder}));case 4:a=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),a=-1;case 10:return e.prev=10,n.displayOrder=a+1,e.next=14,n.save();case 14:r.status(201).send(n),e.next=20;break;case 17:e.prev=17,e.t1=e.catch(10),console.log(e.t1);case 20:case"end":return e.stop()}}),e,null,[[1,7],[10,17]])})));return function(t,r){return e.apply(this,arguments)}}(),g=function(){var e=i()(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,m.find({active:!0}).sort({displayOrder:"asc"});case 3:n=e.sent,r.send(n),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),r.status(400).send(e.t0.message);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),h=function(){var e=i()(o().mark((function e(t,r){var n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.params.id,e.next=4,m.findOneAndUpdate({_id:n},{category:t.body.category});case 4:if(a=e.sent){e.next=7;break}return e.abrupt("return",r.status(400).send());case 7:r.status(201).send(a),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),r.status(400).send(e.t0.message);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,r){return e.apply(this,arguments)}}(),y=function(){var e=i()(o().mark((function e(t,r){var n,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id,e.next=3,m.findById(n).exec();case 3:return a=e.sent,e.next=6,m.findOne({displayOrder:a.displayOrder+1}).exec();case 6:return s=e.sent,e.prev=7,s.displayOrder=s.displayOrder-1,e.next=11,s.save();case 11:return a.displayOrder=a.displayOrder+1,e.next=14,a.save();case 14:r.status(201).send(a),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(7),r.status(400).send(e.t0.message);case 20:case"end":return e.stop()}}),e,null,[[7,17]])})));return function(t,r){return e.apply(this,arguments)}}(),w=function(){var e=i()(o().mark((function e(t,r){var n,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id,e.next=3,m.findById(n).exec();case 3:return a=e.sent,e.next=6,m.findOne({displayOrder:a.displayOrder-1}).exec();case 6:return s=e.sent,e.prev=7,s.displayOrder=s.displayOrder+1,e.next=11,s.save();case 11:return a.displayOrder=a.displayOrder-1,e.next=14,a.save();case 14:r.status(201).send(a),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(7),r.status(400).send(e.t0.message);case 20:case"end":return e.stop()}}),e,null,[[7,17]])})));return function(t,r){return e.apply(this,arguments)}}(),b=function(){var e=i()(o().mark((function e(t,r){var n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.params.id,e.next=4,m.findByIdAndDelete(n);case 4:(a=e.sent)||r.status(400).send(),r.status(201).send(a),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),r.status(400).send(e.t0.message);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r){return e.apply(this,arguments)}}(),k=function(){var e=i()(o().mark((function e(t,r){var n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.params.id,e.next=4,m.findById(n).exec();case 4:if(a=e.sent){e.next=7;break}return e.abrupt("return",r.status(400).send());case 7:r.status(201).send(a),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),r.status(400).send(e.t0.message);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,r){return e.apply(this,arguments)}}();const I=require("jsonwebtoken");var O=r.n(I);const S=require("bcryptjs");var q=r.n(S),D=r(334),B=r.n(D);B().config();var _=process.env.JWT_SECRET,U=new(d().Schema)({name:{type:String,required:!0,trim:!0},email:{type:String,required:!0,unique:!0,trim:!0,lowercase:!0,validate:function(e){if(!l().isEmail(e))throw new Error("Email is invalid")}},password:{type:String,required:!0,minlength:7,trim:!0,validate:function(e){if(e.toLowerCase().includes("password"))throw new Error('Password cannot contain "password"')}},tokens:[{token:{type:String,required:!0}}]});U.methods.toJSON=function(){var e=this.toObject();return delete e.password,delete e.tokens,e},U.methods.generateAuthToken=i()(o().mark((function e(){var t,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,r=O().sign({_id:t.id.toString()},_),t.tokens=t.tokens.concat({token:r}),e.next=5,t.save();case 5:return e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)}))),U.statics.findByCredentials=function(){var e=i()(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.findOne({email:t});case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return",{status:"User Not Found"});case 5:return e.next=7,q().compare(r,n.password);case 7:if(e.sent){e.next=10;break}return e.abrupt("return",{status:"Password did  not match"});case 10:return e.abrupt("return",n);case 11:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),U.pre("save",function(){var e=i()(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=this).isModified("password")){e.next=5;break}return e.next=4,q().hash(r.password,8);case 4:r.password=e.sent;case 5:t();case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}());var E=d().model("User",U);const A=E;B().config();var j=process.env.JWT_SECRET;const T=function(){var e=i()(o().mark((function e(t,r,n){var a,s,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.header("Authorization").replace("Bearer ",""),s=O().verify(a,j),e.next=5,A.findOne({_id:s._id,"tokens.token":a});case 5:if(u=e.sent){e.next=8;break}throw new Error;case 8:t.user=u,t.token=a,n(),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),r.status(400).send({error:"Please authenticate"});case 16:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,r,n){return e.apply(this,arguments)}}();var P=new(s().Router);P.post("/categories",T,x),P.get("/categories",g),P.get("/categories/:id",k),P.patch("/categories/:id",T,h),P.delete("/categories/:id",T,b),P.patch("/movecatdown/:id",T,y),P.patch("/movecatup/:id",T,w);const R=P;var C=new(d().Schema)({aboutBlurb:{type:String,required:!1,trim:!0},aboutImgUrl:{type:String,required:!1,trim:!0},aboutImgData:{type:Buffer},aboutTitle:{type:String,required:!1,trim:!0},contactEmail:{type:String,required:!1,trim:!0},contactPhone:{type:String,required:!1,trim:!0},facebookId:{type:String,required:!1,trim:!0},instagramId:{type:String,required:!1,trim:!0},twitterHandle:{type:String,required:!1,trim:!0},youTubeId:{type:String,required:!1,trim:!0},githubId:{type:String,required:!1,trim:!0},linkedinUsername:{type:String,required:!1,trim:!0},resumeUrl:{type:String,required:!1,trim:!0},siteTitle:{type:String,required:!1,trim:!0}});const N=d().model("Settings",C),F=require("sharp");var J=r.n(F),M=function(){var e=i()(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new N(t.body),e.next=3,N.deleteMany({});case 3:return e.sent,e.prev=4,e.next=7,n.save();case 7:r.status(201).send(n),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(4),r.status(400).send(e.t0.message);case 13:case"end":return e.stop()}}),e,null,[[4,10]])})));return function(t,r){return e.apply(this,arguments)}}(),Z=function(){var e=i()(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N.findOne({});case 3:n=e.sent,r.send(n),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),r.status(400).send(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),z=function(){var e=i()(o().mark((function e(t,r){var n,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n="settings/aboutimg",e.next=4,N.findOne({});case 4:return a=e.sent,e.next=7,J()(t.file.buffer).resize({width:400,height:400}).toBuffer();case 7:return s=e.sent,a.aboutImgData=s,a.aboutImgUrl=n,e.next=12,a.save();case 12:r.send({aboutImgUrl:n}),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(0),console.log(e.t0),r.status(500).send(e.t0.message);case 19:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(t,r){return e.apply(this,arguments)}}(),W=function(){var e=i()(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N.findOne({});case 3:if(n=e.sent){e.next=6;break}throw new Error({error:"Setting could not be loaded..."});case 6:n.aboutImgData&&(r.set("Content-type","image/jpg"),r.send(n.aboutImgData)),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),r.status(500).send(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r){return e.apply(this,arguments)}}();const $=require("multer");var V=r.n($),H=V()({limits:{fileSize:3e6},fileFilter:function(e,t,r){if(!t.originalname.match(/\.(jpg|jpeg|png)$/))return r(new Error("Please upload a valid image file"));r(void 0,!0)}}),L=function(e,t,r,n){r.status(400).send({error:e.message})},G=new(s().Router);G.post("/settings",M),G.get("/settings",Z),G.get("/settings/aboutimg",W),G.post("/settings/aboutimg",H.single("aboutImgData"),z,L);const Y=G;var K=r(353),Q=function(){var e=i()(o().mark((function e(t,r){var n,a,s,u,i,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.orientation,a=-1,e.prev=2,e.next=5,K.default.find({orientation:n}).sort({displayOrder:-1}).limit(1).then((function(e){return e[0].displayOrder}));case 5:a=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.log(e.t0);case 11:return e.prev=11,e.next=14,J()(t.file.buffer).toBuffer();case 14:return s=e.sent,e.next=17,new K.default({orientation:n,isForeground:!1,displayOrder:a+1,sliderImgUrl:"",sliderImgData:s});case 17:return u=e.sent,e.next=20,u.save();case 20:return i="sliderimgs/".concat(u._id),u.sliderImgUrl=i,e.next=24,u.save();case 24:return e.next=26,K.default.find({});case 26:c=e.sent,r.status(201).send(c),e.next=33;break;case 30:e.prev=30,e.t1=e.catch(11),r.status(400).send(e.t1);case 33:case"end":return e.stop()}}),e,null,[[2,8],[11,30]])})));return function(t,r){return e.apply(this,arguments)}}(),X=function(){var e=i()(o().mark((function e(t,r){var n,a,s,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id,e.next=3,K.default.findById(n).exec();case 3:return a=e.sent,e.next=6,K.default.findOne({displayOrder:a.displayOrder-1}).exec();case 6:return s=e.sent,e.prev=7,s.displayOrder=s.displayOrder+1,e.next=11,s.save();case 11:return a.displayOrder=a.displayOrder-1,e.next=14,a.save();case 14:return e.next=16,K.default.find({});case 16:u=e.sent,r.status(201).send(u),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(7),r.status(400).send(e.t0.message);case 23:case"end":return e.stop()}}),e,null,[[7,20]])})));return function(t,r){return e.apply(this,arguments)}}(),ee=function(){var e=i()(o().mark((function e(t,r){var n,a,s,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id,e.next=3,K.default.findById(n).exec();case 3:return a=e.sent,e.next=6,K.default.findOne({displayOrder:a.displayOrder+1}).exec();case 6:return s=e.sent,e.prev=7,s.displayOrder=s.displayOrder-1,e.next=11,s.save();case 11:return a.displayOrder=a.displayOrder+1,e.next=14,a.save();case 14:return e.next=16,K.default.find({});case 16:u=e.sent,r.status(201).send(u),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(7),r.status(400).send(e.t0.message);case 23:case"end":return e.stop()}}),e,null,[[7,20]])})));return function(t,r){return e.apply(this,arguments)}}(),te=function(){var e=i()(o().mark((function e(t,r){var n,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id,e.prev=1,e.next=4,K.default.findByIdAndDelete(n);case 4:if(a=e.sent){e.next=7;break}return e.abrupt("return",r.status(404).send());case 7:return e.next=9,K.default.find({});case 9:(s=e.sent).forEach(function(){var e=i()(o().mark((function e(t,r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.displayOrder>=a.displayOrder)){e.next=5;break}return s[r].displayOrder=s[r].displayOrder-1,e.next=4,s[r].save();case 4:delete s[r].sliderImgData;case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()),r.send(s),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),r.status(500).send();case 17:case"end":return e.stop()}}),e,null,[[1,14]])})));return function(t,r){return e.apply(this,arguments)}}(),re=function(){var e=i()(o().mark((function e(t,r){var n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id,e.prev=1,e.next=4,K.default.findById(n);case 4:(a=e.sent)&&a.sliderImgData&&(r.set("Content-type","image/jpg"),r.send(a.sliderImgData)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),r.status(500).send(e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,r){return e.apply(this,arguments)}}(),ne=function(){var e=i()(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,K.default.find({}).select(["-sliderImgData"]);case 3:if(n=e.sent){e.next=6;break}return e.abrupt("return",r.status(400).send());case 6:r.send(n),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),r.status(500).send();case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r){return e.apply(this,arguments)}}(),ae=function(){var e=i()(o().mark((function e(t,r){var n,a,s,u,i,c,p;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id,e.prev=1,e.next=4,K.default.findById(n);case 4:return a=e.sent,s=a.orientation,u={multi:!0,upsert:!0},i={orientation:s},c={$set:{isForeground:!1}},e.next=11,K.default.updateMany(i,c,u);case 11:return a.isForeground=!0,e.next=14,a.save();case 14:return e.next=16,K.default.find({});case 16:p=e.sent,r.send(p),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(1),r.status(500).send(e.t0);case 23:case"end":return e.stop()}}),e,null,[[1,20]])})));return function(t,r){return e.apply(this,arguments)}}(),se=new(s().Router);se.post("/sliderimgs/:orientation",H.single("sliderImgData"),Q,L),se.get("/sliderimgs",ne),se.get("/sliderimgs/:id",re),se.put("/sliderimgs/moveup/:id",X),se.put("/sliderimgs/movedown/:id",ee),se.patch("/sliderimgs/:id",ae),se.delete("/sliderimgs/:id",te);const ue=se;var ie=function(){var e=i()(o().mark((function e(t,r){var n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new A(t.body),e.prev=1,e.next=4,n.save();case 4:a=n.generateAuthToken(),r.status(201).send({user:n,token:a}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),r.status(400).send(e.t0.message);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,r){return e.apply(this,arguments)}}(),ce=function(){var e=i()(o().mark((function e(t,r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.send(t.user);case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),oe=function(){var e=i()(o().mark((function e(t,r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,A.find();case 3:users=e.sent,r.send(users),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),r.send(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),pe=function(){var e=i()(o().mark((function e(t,r){var n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id,e.prev=1,e.next=4,A.findById(n).exec();case 4:if(a=e.sent){e.next=7;break}return e.abrupt("return",r.status(400).send());case 7:r.send(a),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),r.status(500).send(e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t,r){return e.apply(this,arguments)}}(),de=function(){var e=i()(o().mark((function e(t,r){var n,a,s,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.params.id,a=Object.keys(t.body),s=["name","email","password"],a.every((function(e){return s.includes(e)}))){e.next=6;break}return e.abrupt("return",r.status(400).send("Invalid updates"));case 6:return e.prev=6,e.next=9,A.findByIdAndUpdate(n,t.body,{new:!0,runValidators:!0});case 9:return u=e.sent,a.forEach((function(e){return u[e]=t.body[e]})),e.next=13,u.save();case 13:if(u){e.next=15;break}return e.abrupt("return",r.status(404).send());case 15:r.send(u),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(6),r.status(400).send(e.t0);case 21:case"end":return e.stop()}}),e,null,[[6,18]])})));return function(t,r){return e.apply(this,arguments)}}(),fe=function(){var e=i()(o().mark((function e(t,r){var n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id,e.prev=1,e.next=4,A.findByIdAndDelete(n);case 4:if(a=e.sent){e.next=7;break}return e.abrupt("return",r.status(404).send());case 7:r.send(a),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),r.status(500).send();case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t,r){return e.apply(this,arguments)}}(),le=function(){var e=i()(o().mark((function e(t,r){var n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,A.findByCredentials(t.body.email,t.body.password);case 3:if((n=e.sent)&&n.email){e.next=8;break}r.status(200).send(n),e.next=12;break;case 8:return e.next=10,n.generateAuthToken();case 10:a=e.sent,r.send({user:n,token:a});case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),r.status(400).send();case 17:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t,r){return e.apply(this,arguments)}}(),ve=function(){var e=i()(o().mark((function e(t,r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.user.tokens=t.user.tokens.filter((function(e){return e.token!==t.token})),e.next=4,t.user.save();case 4:r.send({logout:"success"}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),r.status(500).send({logout:"fail",reason:e.t0.message});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),me=function(){var e=i()(o().mark((function e(t,r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.user.tokens=[],e.next=4,t.user.save();case 4:r.send(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),r.status(500).send();case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),xe=new(s().Router);xe.post("/users",ie),xe.get("/users/me",T,ce),xe.post("/users/logout",T,ve),xe.post("/users/logoutAll",T,me),xe.get("/users/",T,oe),xe.get("/users/:id",T,pe),xe.patch("/users/:id",T,de),xe.delete("/users/:id",T,fe),xe.post("/users/login",le);const ge=xe;var he=new(d().Schema)({githubUrl:{type:String,required:!1,trim:!0},longDesc:{type:String,required:!1,trim:!0},projectTitle:{type:String,required:!0,trim:!0},projectUrl:{type:String,required:!1,trim:!0},published:{type:Boolean,required:!1,default:!1},shortDesc:{type:String,required:!1,trim:!0},techSpecs:{type:String,required:!1,trim:!0},previewImgUrl:{type:String,required:!1,trim:!0},previewImgData:{type:Buffer,required:!1},cso:[{category_id:{type:String},displayOrder:{type:Number}}],auxImgs:[{auxImgUrl:{type:String},auxImgData:{type:Buffer}}],auxImgAspectRatio:{type:Number,required:!1}},{timestamps:!0});const ye=d().model("Portfolio",he);var we=function(){var e=i()(o().mark((function e(t,r){var n,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id,e.prev=1,delete(a=t.body).published,delete a.auxImgs,e.next=7,ye.findOneAndUpdate({_id:n},a);case 7:if(e.sent){e.next=10;break}return e.abrupt("return",r.status(400).send());case 10:return e.next=12,ye.findById(n);case 12:s=e.sent,r.send(s),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(1),r.status(400).send();case 19:case"end":return e.stop()}}),e,null,[[1,16]])})));return function(t,r){return e.apply(this,arguments)}}(),be=function(){var e=i()(o().mark((function e(t,r){var n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id,e.prev=1,e.next=4,ye.findById(n);case 4:if(a=e.sent){e.next=7;break}return e.abrupt("return",r.status(500).send());case 7:return e.next=9,a.remove();case 9:delete a.previewImgData,r.send(a),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),r.status(400).send();case 16:case"end":return e.stop()}}),e,null,[[1,13]])})));return function(t,r){return e.apply(this,arguments)}}(),ke=function(){var e=i()(o().mark((function e(t,r){var n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body,a=new ye(n),e.prev=2,e.next=5,a.save();case 5:r.status(200).send(a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),r.status(500).send(e.t0);case 11:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t,r){return e.apply(this,arguments)}}(),Ie=function(){var e=i()(o().mark((function e(t,r){var n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id,e.prev=1,e.next=4,ye.findById(n);case 4:if(a=e.sent){e.next=7;break}return e.abrupt("return",r.status(404).send());case 7:delete a.createdAt,delete a.updatedAt,delete a.__v,r.send(a),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),r.status(500).send();case 16:case"end":return e.stop()}}),e,null,[[1,13]])})));return function(t,r){return e.apply(this,arguments)}}(),Oe=function(){var e=i()(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ye.find({}).select(["-previewImgData","-auxImgs.auxImgData"]);case 3:if(n=e.sent){e.next=6;break}return e.abrupt("return",r.status(400).send("Apparenlty, there is nothing in your portfolio...."));case 6:r.send(n),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),r.status(400).send(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,r){return e.apply(this,arguments)}}(),Se=function(){var e=i()(o().mark((function e(t,r){var n,a,s,u,i,c=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>2&&void 0!==c[2]?c[2]:1,e.next=3,ye.findById(t);case 3:return a=e.sent,s=a.cso,u=s.findIndex((function(e){return e.category_id===r})),i=s[u].displayOrder,a.cso[u].displayOrder=i+n,e.next=10,a.save();case 10:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),qe=function(){var e=i()(o().mark((function e(t,r){var n,a,s,u,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body,a=n.categoryId,s=n.portfolioId,u=n.adjacentId,e.prev=1,console.clear(),e.next=5,Se(s,a,-1);case 5:return e.next=7,Se(u,a,1);case 7:return e.next=9,ye.find({});case 9:i=e.sent,r.send(i),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),r.status(400).send({error:e.t0.message});case 16:case"end":return e.stop()}}),e,null,[[1,13]])})));return function(t,r){return e.apply(this,arguments)}}(),De=function(){var e=i()(o().mark((function e(t,r){var n,a,s,u,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body,a=n.categoryId,s=n.portfolioId,u=n.adjacentId,e.prev=1,console.clear(),e.next=5,Se(s,a,1);case 5:return e.next=7,Se(u,a,-1);case 7:return e.next=9,ye.find({});case 9:i=e.sent,r.send(i),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),r.status(400).send({error:e.t0.message});case 16:case"end":return e.stop()}}),e,null,[[1,13]])})));return function(t,r){return e.apply(this,arguments)}}(),Be=function(){var e=i()(o().mark((function e(t,r){var n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id,e.prev=1,e.next=4,ye.findById(n);case 4:if(a=e.sent){e.next=7;break}return e.abrupt("return",r.status(400).send());case 7:return a.published=!a.published,e.next=10,a.save();case 10:r.send(a),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),r.status(500).send(e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,13]])})));return function(t,r){return e.apply(this,arguments)}}(),_e=function(){var e=i()(o().mark((function e(t,r){var n,a,s,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id,e.prev=1,a="portfolio/".concat(n,"/previewimg"),e.next=5,ye.findById(n);case 5:return s=e.sent,e.next=8,J()(t.file.buffer).resize({width:400,height:600}).toBuffer();case 8:return u=e.sent,s.previewImgData=u,s.previewImgUrl=a,e.next=13,s.save();case 13:r.send({previewImgUrl:a,portfolioId:n}),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(1),console.log(e.t0),r.status(500).send(e.t0.message);case 20:case"end":return e.stop()}}),e,null,[[1,16]])})));return function(t,r){return e.apply(this,arguments)}}(),Ue=function(){var e=i()(o().mark((function e(t,r){var n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.portfolioId,e.prev=1,e.next=4,ye.findById(n);case 4:(a=e.sent).previewImgData=void 0,a.previewImgUrl=void 0,r.send({portfolioId:n}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),r.status(500).send(e.t0.message);case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t,r){return e.apply(this,arguments)}}(),Ee=function(){var e=i()(o().mark((function e(t,r){var n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id,e.prev=1,e.next=4,ye.findById(n);case 4:if(a=e.sent){e.next=7;break}throw new Error({error:"This portfolio item could not be located"});case 7:a.previewImgData&&(r.set("Content-type","image/jpg"),r.send(a.previewImgData)),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),r.status(500).send(e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t,r){return e.apply(this,arguments)}}(),Ae=function(){var e=i()(o().mark((function e(t,r){var n,a,s,u,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params,a=n.id,s=n.auximgid,e.prev=1,e.next=4,ye.findById(a);case 4:if(u=e.sent){e.next=7;break}throw new Error({error:"This portfolio could not be located"});case 7:u.auxImgs&&u.auxImgs.length>0&&(i=u.auxImgs.find((function(e){return e._id.toString()===s.trim()})))&&i.auxImgData&&(r.set("Content-type","image/jpg"),r.send(i.auxImgData)),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),r.status(500).send(e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t,r){return e.apply(this,arguments)}}(),je=function(){var e=i()(o().mark((function e(t,r){var n,a,s,u,i,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.id,e.prev=1,e.next=4,ye.findById(n);case 4:return a=e.sent,e.next=7,J()(t.file.buffer).toBuffer();case 7:return s=e.sent,(u=a.auxImgs).push({auxImgUrl:"",auxImgData:s}),a.auxImgs=u,i=a.auxImgs[a.auxImgs.length-1]._id,a.auxImgs[a.auxImgs.length-1].auxImgUrl="portfolio/".concat(n,"/auximg/").concat(i),e.next=15,a.save();case 15:for(u=a.auxImgs,c=0;c<=u.length-1;c++)u[c]={_id:u[c].id,auxImgUrl:u[c].auxImgUrl};r.send(u),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(1),r.status(500).send(e.t0);case 23:case"end":return e.stop()}}),e,null,[[1,20]])})));return function(t,r){return e.apply(this,arguments)}}(),Te=function(){var e=i()(o().mark((function e(t,r){var n,a,s,u,i,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params,a=n.id,s=n.auximgid,e.next=3,ye.findById(a);case 3:if(u=e.sent,e.prev=4,u){e.next=7;break}throw new Error({error:"This portfolio could not be located"});case 7:if(!(u.auxImgs&&u.auxImgs.length>0)){e.next=16;break}return i=u.auxImgs.slice(),c=i.findIndex((function(e){return e._id===s})),i.splice(c,1),u.auxImgs=i,e.next=14,u.save();case 14:i.forEach((function(e,t){delete i[t].auxImgData})),r.send(i);case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(4),r.status(500).send(e.t0);case 21:case"end":return e.stop()}}),e,null,[[4,18]])})));return function(t,r){return e.apply(this,arguments)}}(),Pe=new(s().Router);Pe.post("/portfolio",T,ke),Pe.get("/portfolio",Oe),Pe.get("/portfolio/:id",Ie),Pe.patch("/portfolio/:id",T,we),Pe.delete("/portfolio/:id",T,be),Pe.patch("/portfolio/publish/:id",T,Be),Pe.post("/portfolio/moveup",T,qe),Pe.post("/portfolio/movedown",T,De),Pe.get("/portfolio/:id/previewimg",Ee),Pe.post("/portfolio/:id/previewimg",H.single("previewImgData"),_e,L),Pe.delete("/portfolio/:id/previewimg",Ue),Pe.get("/portfolio/:id/auximg/:auximgid",Ae),Pe.delete("/portfolio/:id/auximg/:auximgid",Te),Pe.post("/portfolio/:id/auximg",H.single("auxImgData"),je,L);const Re=Pe;require("@babel/runtime/helpers/defineProperty"),r(91),r(353);var Ce=new(s().Router),Ne=V()({limits:{fileSize:1024e3},fileFilter:function(e,t,r){if(!t.originalname.match(/\.json$/))return r(new Error("Please upload a valid JSON data file"));r(void 0,!0)}});Ce.post("/legacy-import",T,Ne.single("rawdata"),function(){var e=i()(o().mark((function e(t,r){var n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.file.buffer;case 3:if(n=e.sent){e.next=6;break}return e.abrupt("return",r.status(400).send());case 6:return a=JSON.parse(n),e.next=9,importPortfolioData(t,r,a.portfolio,a.categories);case 9:return e.next=11,importSliderData(a.settings.sliderImgs);case 11:return e.next=13,importSettingsData(a.settings);case 13:r.send("Data import complete!"),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),r.status(400).send({error:e.t0.message});case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t,r){return e.apply(this,arguments)}}(),(function(e,t,r,n){r.status(400).send({error:e.message})}));const Fe=Ce;var Je=function(){var e=i()(o().mark((function e(t,r){var n,a,s,u,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ye.find({}).select(["-previewImgData","-auxImgs.auxImgData"]);case 3:return n=e.sent,e.next=6,m.find({active:!0});case 6:return a=e.sent,e.next=9,N.findOne({}).select(["-aboutImgData"]);case 9:return s=e.sent,e.next=12,K.default.find({}).select(["-sliderImgData"]);case 12:u=e.sent,i={portfolio:n,categories:a,settings:s,sliderImgs:u},r.send(i),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(0),r.status(400).send(e.t0);case 20:case"end":return e.stop()}}),e,null,[[0,17]])})));return function(t,r){return e.apply(this,arguments)}}(),Me=new(s().Router);Me.get("/appdata/",Je);var Ze=[R,Y,ue,ge,Re,Fe,Me];new(s().Router);const ze=require("cors");var We=r.n(ze),$e=s()();$e.use(We()()),$e.use(s().json()),function(e){Ze.forEach((function(t){e.use(t)}))}($e),$e.listen(e.Z.port,(function(){var t=console.log,r=(n().red,n().green),a=n().yellow;console.clear(),t(r("\n\n> Starting up WebFolio API...\n\n")),t("".concat(r("> Data Source:........")," ").concat(a(e.Z.db_url))),t("".concat(r("> Environment:.....")," ").concat(e.Z.app_env)),t("\n\nAPI server running on port "+e.Z.port+" - yay!")}))})()})();